<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>轻量级门户页面</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link
      href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <!-- 引入自定义CSS -->
    <link rel="stylesheet" href="src/css/style.css" />
    <!-- Tailwind配置 -->
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#165DFF",
              secondary: "#4080FF",
              accent: "#FF7D00",
              success: "#00B42A",
              warning: "#FF7D00",
              danger: "#F53F3F",
              dark: {
                100: "#F2F3F5",
                200: "#E5E6EB",
                300: "#C9CDD4",
                400: "#86909C",
                500: "#4E5969",
                600: "#272E3B",
                700: "#1D2129",
                800: "#0A0C10",
              },
            },
            fontFamily: {
              sans: ["Inter", "system-ui", "sans-serif"],
            },
          },
        },
      };
    </script>
    <!-- 移除原有 <style> 和 <script> 标签 -->
  </head>

  <body
    class="light bg-gray-50 text-gray-800 dark:bg-dark-700 dark:text-gray-100 min-h-screen flex flex-col"
  >
    <!-- 背景图容器 -->
    <div
      id="background-container"
      class="fixed inset-0 z-0 transition-all-custom"
    >
      <img
        id="background-image"
        src="https://picsum.photos/id/1002/1920/1080"
        alt="默认背景图"
        class="w-full h-full object-cover opacity-40 dark:opacity-20"
      />
      <div
        class="absolute inset-0 bg-gradient-to-b from-black/10 to-black/30 dark:from-black/30 dark:to-black/50"
      ></div>
    </div>

    <!-- 主容器 -->
    <div class="container mx-auto px-4 py-8 relative z-10 flex-grow">
      <!-- 顶部工具栏 -->
      <header class="mb-8 animate-fadeIn">
        <div
          class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
        >
          <div class="flex items-center gap-2">
            <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-primary">
              <i class="fa fa-home mr-2"></i>jason
            </h1>
            <span
              id="minimal-mode-indicator"
              class="hidden px-2 py-1 bg-accent/10 text-accent text-sm rounded-full"
            >
              <i class="fa fa-compress mr-1"></i>极简模式
            </span>
          </div>

          <div class="flex items-center gap-3">
            <!-- 搜索引擎切换 -->
            <div class="relative">
              <select
                id="search-engine"
                class="appearance-none bg-white/80 dark:bg-dark-600/80 backdrop-blur border border-gray-200 dark:border-dark-500 rounded-lg px-4 py-2 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all-custom"
              >
                <option value="baidu">百度搜索</option>
                <option value="bing">必应搜索</option>
              </select>
              <i
                class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"
              ></i>
            </div>

            <!-- 背景设置按钮 -->
            <button
              id="bg-settings-btn"
              class="p-2 bg-white/80 dark:bg-dark-600/80 backdrop-blur rounded-lg hover:bg-white dark:hover:bg-dark-500 transition-all-custom"
            >
              <i class="fa fa-image text-gray-600 dark:text-gray-300"></i>
            </button>

            <!-- 主题切换按钮 -->
            <button
              id="theme-toggle"
              class="p-2 bg-white/80 dark:bg-dark-600/80 backdrop-blur rounded-lg hover:bg-white dark:hover:bg-dark-500 transition-all-custom"
            >
              <i class="fa fa-moon-o dark:hidden text-gray-600"></i>
              <i class="fa fa-sun-o hidden dark:inline text-gray-300"></i>
            </button>

            <!-- 极简模式切换 -->
            <button
              id="minimal-mode-toggle"
              class="p-2 bg-white/80 dark:bg-dark-600/80 backdrop-blur rounded-lg hover:bg-white dark:hover:bg-dark-500 transition-all-custom"
            >
              <i class="fa fa-compress text-gray-600 dark:text-gray-300"></i>
            </button>
          </div>
        </div>

        <!-- 搜索栏 -->
        <div class="mt-6 relative max-w-3xl w-full mx-auto">
          <form id="search-form" class="relative">
            <input
              type="text"
              id="search-input"
              placeholder="输入搜索内容..."
              class="w-full px-5 py-3 pr-12 rounded-xl bg-white/90 dark:bg-dark-600/90 backdrop-blur border border-gray-200 dark:border-dark-500 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all-custom shadow-sm"
            />
            <button
              type="submit"
              class="absolute right-3 top-1/2 -translate-y-1/2 p-1.5 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all-custom"
            >
              <i class="fa fa-search"></i>
            </button>
          </form>

          <!-- 搜索历史 -->
          <div
            id="search-history"
            class="hidden mt-2 bg-white/90 dark:bg-dark-600/90 backdrop-blur rounded-xl shadow-md overflow-hidden border border-gray-200 dark:border-dark-500"
          >
            <div
              class="p-2 flex justify-between items-center border-b border-gray-200 dark:border-dark-500"
            >
              <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400">
                搜索历史
              </h3>
              <button
                id="clear-history"
                class="text-xs text-primary hover:text-primary/80"
              >
                清空
              </button>
            </div>
            <ul id="history-list" class="max-h-48 overflow-y-auto">
              <!-- 搜索历史项将通过JS动态添加 -->
            </ul>
          </div>
        </div>
      </header>

      <!-- 收藏栏 -->
      <section
        id="bookmarks-section"
        class="mt-4 bg-white/80 dark:bg-dark-600/80 backdrop-blur rounded-2xl p-5 shadow-md border border-gray-200 dark:border-dark-500 transition-all-custom animate-slideIn"
      >
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold flex items-center">
            <i class="fa fa-star text-primary mr-2"></i>收藏栏
          </h2>
          <div class="flex gap-2">
            <button
              id="bookmark-batch-actions"
              class="bg-gray-100 dark:bg-dark-500 hover:bg-gray-200 dark:hover:bg-dark-400 py-1.5 px-3 rounded-lg text-sm transition-all-custom flex items-center"
            >
              <i class="fa fa-cog mr-1"></i>批量操作
            </button>
            <button
              id="add-bookmark-btn"
              class="bg-primary/10 hover:bg-primary/20 text-primary py-1.5 px-3 rounded-lg text-sm transition-all-custom flex items-center"
            >
              <i class="fa fa-plus mr-1"></i>添加收藏
            </button>
          </div>
        </div>

        <!-- 批量操作工具栏 (默认隐藏) -->
        <div
          id="batch-operations"
          class="hidden mb-4 p-3 bg-gray-50 dark:bg-dark-500/50 rounded-lg border border-gray-200 dark:border-dark-400"
        >
          <div class="flex flex-wrap gap-2">
            <button
              id="select-all"
              class="px-3 py-1.5 text-sm bg-gray-100 dark:bg-dark-500 rounded-lg hover:bg-gray-200 dark:hover:bg-dark-400 transition-all-custom"
            >
              <i class="fa fa-check-square-o mr-1"></i>全选
            </button>
            <button
              id="deselect-all"
              class="px-3 py-1.5 text-sm bg-gray-100 dark:bg-dark-500 rounded-lg hover:bg-gray-200 dark:hover:bg-dark-400 transition-all-custom"
            >
              <i class="fa fa-square-o mr-1"></i>取消全选
            </button>
            <button
              id="batch-delete"
              class="px-3 py-1.5 text-sm bg-danger/10 text-danger rounded-lg hover:bg-danger/20 transition-all-custom"
            >
              <i class="fa fa-trash mr-1"></i>批量删除
            </button>
            <button
              id="exit-batch"
              class="px-3 py-1.5 text-sm bg-gray-100 dark:bg-dark-500 rounded-lg hover:bg-gray-200 dark:hover:bg-dark-400 transition-all-custom ml-auto"
            >
              <i class="fa fa-times mr-1"></i>退出
            </button>
          </div>
        </div>

        <!-- 收藏列表 -->
        <div
          id="bookmarks-container"
          class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3"
        >
          <!-- 收藏项将通过JS动态添加 -->
          <div id="empty-bookmarks" class="col-span-full py-16 text-center">
            <i
              class="fa fa-bookmark-o text-4xl text-gray-300 dark:text-gray-600 mb-3"
            ></i>
            <p class="text-gray-500 dark:text-gray-400">
              暂无收藏，添加你的常用网站吧！
            </p>
          </div>
        </div>
      </section>
    </div>

    <!-- 页脚 -->
    <footer
      class="mt-auto py-4 text-center text-sm text-gray-500 dark:text-gray-400 relative z-10"
    >
      <p>
        © 2023 轻量级门户页面 | 最后更新:
        <span id="last-updated">2023-10-01</span>
      </p>
    </footer>

    <!-- 模态框：添加/编辑收藏 -->
    <div
      id="bookmark-modal"
      class="fixed inset-0 z-50 flex items-center justify-center hidden"
    >
      <div
        class="absolute inset-0 bg-black/50 backdrop-blur-sm"
        id="modal-overlay"
      ></div>
      <div
        class="relative bg-white dark:bg-dark-600 rounded-2xl shadow-xl w-full max-w-md p-6 transform transition-all-custom"
      >
        <button
          id="close-bookmark-modal"
          class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"
        >
          <i class="fa fa-times"></i>
        </button>

        <h3 class="text-xl font-bold mb-4" id="bookmark-modal-title">
          添加收藏
        </h3>

        <form id="bookmark-form" class="space-y-4">
          <input type="hidden" id="bookmark-id" />

          <div>
            <label
              for="bookmark-name"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
              >名称</label
            >
            <input
              type="text"
              id="bookmark-name"
              placeholder="输入网站名称..."
              class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-dark-400 bg-white dark:bg-dark-700 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all-custom"
              required
            />
          </div>

          <div>
            <label
              for="bookmark-url"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
              >网址</label
            >
            <input
              type="url"
              id="bookmark-url"
              placeholder="https://example.com"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-dark-400 bg-white dark:bg-dark-700 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all-custom"
              required
            />
          </div>

          <div>
            <label
              for="bookmark-icon"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
              >图标</label
            >
            <div class="flex gap-2">
              <input
                type="text"
                id="bookmark-icon"
                placeholder="fa-heart"
                class="flex-1 px-4 py-2 rounded-lg border border-gray-300 dark:border-dark-400 bg-white dark:bg-dark-700 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all-custom"
                required
              />
              <div
                class="flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 dark:border-dark-400 bg-gray-100 dark:bg-dark-500"
              >
                <i id="icon-preview" class="fa fa-link text-gray-500"></i>
              </div>
            </div>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              使用Font Awesome图标名称，如"fa-google"
            </p>
          </div>

          <div class="flex gap-2 pt-2">
            <button
              type="submit"
              class="flex-1 bg-primary hover:bg-primary/90 text-white py-2 px-4 rounded-lg transition-all-custom"
            >
              保存
            </button>
            <button
              type="button"
              id="delete-bookmark-btn"
              class="hidden px-4 py-2 bg-danger text-white rounded-lg hover:bg-danger/90 transition-all-custom"
            >
              删除
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- 模态框：背景设置 -->
    <div
      id="bg-modal"
      class="fixed inset-0 z-50 flex items-center justify-center hidden"
    >
      <div
        class="absolute inset-0 bg-black/50 backdrop-blur-sm"
        id="bg-modal-overlay"
      ></div>
      <div
        class="relative bg-white dark:bg-dark-600 rounded-2xl shadow-xl w-full max-w-md p-6 transform transition-all-custom"
      >
        <button
          id="close-bg-modal"
          class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"
        >
          <i class="fa fa-times"></i>
        </button>

        <h3 class="text-xl font-bold mb-4">背景设置</h3>

        <div class="space-y-4">
          <div>
            <label
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
              >默认背景</label
            >
            <div class="grid grid-cols-3 gap-2">
              <div
                class="bg-gray-200 dark:bg-dark-500 rounded-lg overflow-hidden cursor-pointer bg-option"
                data-bg="https://picsum.photos/id/1002/1920/1080"
              >
                <img
                  src="https://picsum.photos/id/1002/300/200"
                  alt="背景选项1"
                  class="w-full h-20 object-cover"
                />
              </div>
              <div
                class="bg-gray-200 dark:bg-dark-500 rounded-lg overflow-hidden cursor-pointer bg-option"
                data-bg="https://picsum.photos/id/1015/1920/1080"
              >
                <img
                  src="https://picsum.photos/id/1015/300/200"
                  alt="背景选项2"
                  class="w-full h-20 object-cover"
                />
              </div>
              <div
                class="bg-gray-200 dark:bg-dark-500 rounded-lg overflow-hidden cursor-pointer bg-option"
                data-bg="https://picsum.photos/id/1018/1920/1080"
              >
                <img
                  src="https://picsum.photos/id/1018/300/200"
                  alt="背景选项3"
                  class="w-full h-20 object-cover"
                />
              </div>
            </div>
          </div>

          <div>
            <label
              for="bg-upload"
              class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
              >上传本地图片</label
            >
            <div
              class="border-2 border-dashed border-gray-300 dark:border-dark-400 rounded-lg p-4 text-center hover:bg-gray-50 dark:hover:bg-dark-500 transition-all-custom"
            >
              <input
                type="file"
                id="bg-upload"
                accept="image/*"
                class="hidden"
              />
              <label for="bg-upload" class="cursor-pointer">
                <i class="fa fa-upload text-2xl text-gray-400 mb-2"></i>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  点击或拖拽图片到此处上传
                </p>
              </label>
            </div>
          </div>

          <div class="pt-2">
            <button
              id="reset-bg"
              class="w-full py-2 px-4 border border-gray-300 dark:border-dark-400 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-500 transition-all-custom"
            >
              恢复默认背景
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 确认对话框 -->
    <div
      id="confirm-dialog"
      class="fixed inset-0 z-50 flex items-center justify-center hidden"
    >
      <div
        class="absolute inset-0 bg-black/50 backdrop-blur-sm"
        id="confirm-overlay"
      ></div>
      <div
        class="relative bg-white dark:bg-dark-600 rounded-2xl shadow-xl w-full max-w-md p-6 transform transition-all-custom"
      >
        <h3 class="text-xl font-bold mb-2" id="confirm-title">确认操作</h3>
        <p class="text-gray-600 dark:text-gray-300 mb-4" id="confirm-message">
          你确定要执行此操作吗？
        </p>

        <div class="flex gap-2">
          <button
            id="confirm-cancel"
            class="flex-1 py-2 px-4 border border-gray-300 dark:border-dark-400 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-500 transition-all-custom"
          >
            取消
          </button>
          <button
            id="confirm-ok"
            class="flex-1 py-2 px-4 bg-danger text-white rounded-lg hover:bg-danger/90 transition-all-custom"
          >
            确认
          </button>
        </div>
      </div>
    </div>

    <!-- 通知提示 -->
    <div
      id="notification"
      class="fixed bottom-4 right-4 max-w-sm p-4 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all-custom z-50 flex items-center gap-3"
    >
      <i
        id="notification-icon"
        class="fa fa-check-circle text-success text-xl"
      ></i>
      <div>
        <h4 id="notification-title" class="font-medium"></h4>
        <p
          id="notification-message"
          class="text-sm text-gray-600 dark:text-gray-300"
        ></p>
      </div>
      <button
        id="close-notification"
        class="ml-auto text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"
      >
        <i class="fa fa-times"></i>
      </button>
    </div>

    <script>
      // 数据模型
      const AppData = {
        // 初始化数据
        init() {
          // 检查本地存储中是否有数据，没有则初始化
          if (!localStorage.getItem("bookmarks")) {
            localStorage.setItem("bookmarks", JSON.stringify([]));
          }

          if (!localStorage.getItem("searchHistory")) {
            localStorage.setItem("searchHistory", JSON.stringify([]));
          }

          if (!localStorage.getItem("settings")) {
            const defaultSettings = {
              theme: "light",
              background: "https://picsum.photos/id/1002/1920/1080",
              searchEngine: "baidu",
              minimalMode: false,
              lastUpdated: new Date().toISOString().split("T")[0],
            };
            localStorage.setItem("settings", JSON.stringify(defaultSettings));
          }
        },

        // 获取收藏
        getBookmarks() {
          return JSON.parse(localStorage.getItem("bookmarks") || "[]");
        },

        // 保存收藏
        saveBookmarks(bookmarks) {
          localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
          this.updateLastUpdated();
        },

        // 添加收藏
        addBookmark(bookmark) {
          const bookmarks = this.getBookmarks();
          const newBookmark = {
            id: Date.now().toString(),
            name: bookmark.name,
            url: bookmark.url,
            icon: bookmark.icon || "fa-link",
            createdAt: new Date().toISOString(),
          };
          bookmarks.push(newBookmark);
          this.saveBookmarks(bookmarks);
          return newBookmark;
        },

        // 更新收藏
        updateBookmark(id, updatedBookmark) {
          const bookmarks = this.getBookmarks();
          const index = bookmarks.findIndex((bookmark) => bookmark.id === id);
          if (index !== -1) {
            bookmarks[index] = { ...bookmarks[index], ...updatedBookmark };
            this.saveBookmarks(bookmarks);
            return bookmarks[index];
          }
          return null;
        },

        // 删除收藏
        deleteBookmark(id) {
          let bookmarks = this.getBookmarks();
          const bookmarkToDelete = bookmarks.find(
            (bookmark) => bookmark.id === id
          );
          if (bookmarkToDelete) {
            bookmarks = bookmarks.filter((bookmark) => bookmark.id !== id);
            this.saveBookmarks(bookmarks);
            return true;
          }
          return false;
        },

        // 批量删除收藏
        batchDeleteBookmarks(ids) {
          let bookmarks = this.getBookmarks();
          bookmarks = bookmarks.filter(
            (bookmark) => !ids.includes(bookmark.id)
          );
          this.saveBookmarks(bookmarks);
          return true;
        },

        // 重新排序收藏
        reorderBookmarks(newOrder) {
          const bookmarks = this.getBookmarks();
          // 按照新的ID顺序重新排列
          const reordered = newOrder.map((id) =>
            bookmarks.find((b) => b.id === id)
          );
          this.saveBookmarks(reordered);
          return reordered;
        },

        // 获取搜索历史
        getSearchHistory() {
          return JSON.parse(localStorage.getItem("searchHistory") || "[]");
        },

        // 保存搜索历史
        saveSearchHistory(history) {
          // 限制最多10条记录
          if (history.length > 10) {
            history = history.slice(-10);
          }
          localStorage.setItem("searchHistory", JSON.stringify(history));
        },

        // 添加搜索记录
        addSearchQuery(query) {
          if (!query.trim()) return;

          let history = this.getSearchHistory();
          // 移除已存在的相同记录
          history = history.filter((item) => item !== query.trim());
          // 添加新记录到末尾
          history.push(query.trim());
          this.saveSearchHistory(history);
        },

        // 清空搜索历史
        clearSearchHistory() {
          localStorage.setItem("searchHistory", JSON.stringify([]));
        },

        // 获取设置
        getSettings() {
          return JSON.parse(localStorage.getItem("settings") || "{}");
        },

        // 保存设置
        saveSettings(settings) {
          const currentSettings = this.getSettings();
          const updatedSettings = { ...currentSettings, ...settings };
          localStorage.setItem("settings", JSON.stringify(updatedSettings));
        },

        // 更新最后修改时间
        updateLastUpdated() {
          const settings = this.getSettings();
          settings.lastUpdated = new Date().toISOString().split("T")[0];
          this.saveSettings(settings);
        },
      };

      // 视图控制器
      const ViewController = {
        // 初始化视图
        init() {
          this.renderTheme();
          this.renderBackground();
          this.renderSearchEngine();
          this.renderSearchHistory();
          this.renderBookmarks();
          this.renderMinimalMode();
          this.updateLastUpdated();

          // 绑定事件监听
          this.bindEvents();
        },

        // 渲染主题
        renderTheme() {
          const settings = AppData.getSettings();
          if (settings.theme === "dark") {
            document.documentElement.classList.add("dark");
          } else {
            document.documentElement.classList.remove("dark");
          }
        },

        // 渲染背景
        renderBackground() {
          const settings = AppData.getSettings();
          const bgImage = document.getElementById("background-image");
          bgImage.src =
            settings.background || "https://picsum.photos/id/1002/1920/1080";
        },

        // 渲染搜索引擎
        renderSearchEngine() {
          const settings = AppData.getSettings();
          const searchEngine = document.getElementById("search-engine");
          searchEngine.value = settings.searchEngine || "baidu";
        },

        // 渲染搜索历史
        renderSearchHistory() {
          const history = AppData.getSearchHistory();
          const historyList = document.getElementById("history-list");
          const searchHistoryContainer =
            document.getElementById("search-history");

          // 清空列表
          historyList.innerHTML = "";

          // 如果没有历史记录，隐藏容器
          if (history.length === 0) {
            searchHistoryContainer.classList.add("hidden");
            return;
          }

          // 添加历史记录项
          history.forEach((item) => {
            const li = document.createElement("li");
            li.className =
              "px-4 py-2 hover:bg-gray-100 dark:hover:bg-dark-500 cursor-pointer transition-all-custom flex items-center";
            li.innerHTML = `
            <i class="fa fa-history text-gray-400 mr-2"></i>
            <span>${item}</span>
          `;

            // 点击历史项填充搜索框
            li.addEventListener("click", () => {
              document.getElementById("search-input").value = item;
              searchHistoryContainer.classList.add("hidden");
            });

            historyList.appendChild(li);
          });
        },

        // 渲染收藏
        renderBookmarks() {
          const bookmarks = AppData.getBookmarks();
          const bookmarksContainer = document.getElementById(
            "bookmarks-container"
          );
          const emptyBookmarks = document.getElementById("empty-bookmarks");

          // 清空容器
          bookmarksContainer.innerHTML = "";

          // 如果没有收藏，显示空状态
          if (bookmarks.length === 0) {
            bookmarksContainer.appendChild(emptyBookmarks);
            return;
          }

          // 隐藏空状态
          emptyBookmarks.remove();

          // 添加收藏项
          bookmarks.forEach((bookmark) => {
            const bookmarkEl = document.createElement("div");
            bookmarkEl.className =
              "bookmark-item bg-white dark:bg-dark-500 rounded-xl shadow-sm border border-gray-200 dark:border-dark-400 p-4 flex flex-col items-center text-center hover:shadow-md transition-all-custom cursor-pointer relative group";
            bookmarkEl.setAttribute("data-id", bookmark.id);
            bookmarkEl.setAttribute("draggable", "true");

            bookmarkEl.innerHTML = `
            <div class="bookmark-select hidden absolute top-2 left-2 w-4 h-4 rounded border border-gray-300 dark:border-gray-600 flex items-center justify-center">
              <i class="fa fa-check text-xs text-primary"></i>
            </div>
            <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mb-2">
              <i class="fa ${bookmark.icon} text-primary text-xl"></i>
            </div>
            <h3 class="font-medium text-sm mb-1 truncate w-full">${
              bookmark.name
            }</h3>
            <p class="text-xs text-gray-500 dark:text-gray-400 truncate w-full">${
              new URL(bookmark.url).hostname
            }</p>
            <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-all-custom">
              <button class="edit-bookmark p-1.5 text-gray-400 hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-400 rounded-full transition-all-custom">
                <i class="fa fa-pencil"></i>
              </button>
            </div>
          `;

            // 点击收藏项打开链接
            bookmarkEl.addEventListener("click", (e) => {
              // 如果点击的是编辑按钮，不打开链接
              if (e.target.closest(".edit-bookmark") || this.isBatchMode) {
                return;
              }
              window.open(bookmark.url, "_blank");
            });

            // 编辑收藏
            bookmarkEl
              .querySelector(".edit-bookmark")
              .addEventListener("click", (e) => {
                e.stopPropagation();
                this.openBookmarkModal(bookmark);
              });

            // 拖拽排序事件
            bookmarkEl.addEventListener("dragstart", (e) => {
              e.dataTransfer.setData("text/plain", bookmark.id);
              setTimeout(() => {
                bookmarkEl.classList.add("opacity-50");
              }, 0);
            });

            bookmarkEl.addEventListener("dragend", () => {
              bookmarkEl.classList.remove("opacity-50");
              // 移除所有拖拽相关类
              document.querySelectorAll(".bookmark-item").forEach((item) => {
                item.classList.remove("drag-over");
              });
            });

            bookmarkEl.addEventListener("dragover", (e) => {
              e.preventDefault();
              bookmarkEl.classList.add("drag-over");
            });

            bookmarkEl.addEventListener("dragleave", () => {
              bookmarkEl.classList.remove("drag-over");
            });

            bookmarkEl.addEventListener("drop", (e) => {
              e.preventDefault();
              bookmarkEl.classList.remove("drag-over");

              const draggedId = e.dataTransfer.getData("text/plain");
              if (draggedId !== bookmark.id) {
                const bookmarks = AppData.getBookmarks();
                const draggedIndex = bookmarks.findIndex(
                  (b) => b.id === draggedId
                );
                const targetIndex = bookmarks.findIndex(
                  (b) => b.id === bookmark.id
                );

                // 重新排序
                const newBookmarks = [...bookmarks];
                const [draggedItem] = newBookmarks.splice(draggedIndex, 1);
                newBookmarks.splice(targetIndex, 0, draggedItem);

                // 保存新顺序
                AppData.saveBookmarks(newBookmarks);
                // 重新渲染
                this.renderBookmarks();

                this.showNotification("排序成功", "收藏顺序已更新", "success");
              }
            });

            bookmarksContainer.appendChild(bookmarkEl);
          });
        },

        // 渲染极简模式
        renderMinimalMode() {
          const settings = AppData.getSettings();
          const minimalMode = settings.minimalMode || false;
          const minimalModeIndicator = document.getElementById(
            "minimal-mode-indicator"
          );
          const bookmarksSection = document.getElementById("bookmarks-section");

          if (minimalMode) {
            minimalModeIndicator.classList.remove("hidden");
            bookmarksSection.classList.add("hidden");
          } else {
            minimalModeIndicator.classList.add("hidden");
            bookmarksSection.classList.remove("hidden");
          }
        },

        // 更新最后修改时间显示
        updateLastUpdated() {
          const settings = AppData.getSettings();
          document.getElementById("last-updated").textContent =
            settings.lastUpdated || new Date().toISOString().split("T")[0];
        },

        // 打开收藏模态框
        openBookmarkModal(bookmark = null) {
          const modal = document.getElementById("bookmark-modal");
          const modalTitle = document.getElementById("bookmark-modal-title");
          const bookmarkId = document.getElementById("bookmark-id");
          const bookmarkName = document.getElementById("bookmark-name");
          const bookmarkUrl = document.getElementById("bookmark-url");
          const bookmarkIcon = document.getElementById("bookmark-icon");
          const iconPreview = document.getElementById("icon-preview");
          const deleteBtn = document.getElementById("delete-bookmark-btn");

          // 重置表单
          document.getElementById("bookmark-form").reset();
          bookmarkId.value = "";
          iconPreview.className = "fa fa-link text-gray-500";

          if (bookmark) {
            // 编辑模式
            modalTitle.textContent = "编辑收藏";
            bookmarkId.value = bookmark.id;
            bookmarkName.value = bookmark.name;
            bookmarkUrl.value = bookmark.url;
            bookmarkIcon.value = bookmark.icon;
            iconPreview.className = `fa ${bookmark.icon} text-gray-500`;
            deleteBtn.classList.remove("hidden");
          } else {
            // 添加模式
            modalTitle.textContent = "添加收藏";
            deleteBtn.classList.add("hidden");
          }

          // 显示模态框
          modal.classList.remove("hidden");
          setTimeout(() => {
            modal
              .querySelector('div[class*="rounded-2xl"]')
              .classList.add("scale-100");
            modal
              .querySelector('div[class*="rounded-2xl"]')
              .classList.remove("scale-95");
          }, 10);

          // 聚焦到名称输入框
          bookmarkName.focus();
        },

        // 关闭收藏模态框
        closeBookmarkModal() {
          const modal = document.getElementById("bookmark-modal");
          const modalContent = modal.querySelector('div[class*="rounded-2xl"]');

          modalContent.classList.remove("scale-100");
          modalContent.classList.add("scale-95");

          setTimeout(() => {
            modal.classList.add("hidden");
          }, 300);
        },

        // 打开背景设置模态框
        openBgModal() {
          const modal = document.getElementById("bg-modal");

          // 显示模态框
          modal.classList.remove("hidden");
          setTimeout(() => {
            modal
              .querySelector('div[class*="rounded-2xl"]')
              .classList.add("scale-100");
            modal
              .querySelector('div[class*="rounded-2xl"]')
              .classList.remove("scale-95");
          }, 10);
        },

        // 关闭背景设置模态框
        closeBgModal() {
          const modal = document.getElementById("bg-modal");
          const modalContent = modal.querySelector('div[class*="rounded-2xl"]');

          modalContent.classList.remove("scale-100");
          modalContent.classList.add("scale-95");

          setTimeout(() => {
            modal.classList.add("hidden");
          }, 300);
        },

        // 打开确认对话框
        openConfirmDialog(title, message, confirmCallback) {
          const dialog = document.getElementById("confirm-dialog");
          const dialogTitle = document.getElementById("confirm-title");
          const dialogMessage = document.getElementById("confirm-message");
          const confirmOk = document.getElementById("confirm-ok");
          const confirmCancel = document.getElementById("confirm-cancel");

          // 设置对话框内容
          dialogTitle.textContent = title;
          dialogMessage.textContent = message;

          // 显示对话框
          dialog.classList.remove("hidden");
          setTimeout(() => {
            dialog
              .querySelector('div[class*="rounded-2xl"]')
              .classList.add("scale-100");
            dialog
              .querySelector('div[class*="rounded-2xl"]')
              .classList.remove("scale-95");
          }, 10);

          // 绑定确认按钮事件
          const okHandler = () => {
            confirmCallback();
            this.closeConfirmDialog();
            confirmOk.removeEventListener("click", okHandler);
            confirmCancel.removeEventListener("click", cancelHandler);
          };

          // 绑定取消按钮事件
          const cancelHandler = () => {
            this.closeConfirmDialog();
            confirmOk.removeEventListener("click", okHandler);
            confirmCancel.removeEventListener("click", cancelHandler);
          };

          confirmOk.addEventListener("click", okHandler);
          confirmCancel.addEventListener("click", cancelHandler);
        },

        // 关闭确认对话框
        closeConfirmDialog() {
          const dialog = document.getElementById("confirm-dialog");
          const dialogContent = dialog.querySelector(
            'div[class*="rounded-2xl"]'
          );

          dialogContent.classList.remove("scale-100");
          dialogContent.classList.add("scale-95");

          setTimeout(() => {
            dialog.classList.add("hidden");
          }, 300);
        },

        // 显示通知
        showNotification(title, message, type = "success") {
          const notification = document.getElementById("notification");
          const notificationTitle =
            document.getElementById("notification-title");
          const notificationMessage = document.getElementById(
            "notification-message"
          );
          const notificationIcon = document.getElementById("notification-icon");
          const closeBtn = document.getElementById("close-notification");

          // 设置通知内容
          notificationTitle.textContent = title;
          notificationMessage.textContent = message;

          // 设置通知图标和颜色
          notificationIcon.className = "";
          if (type === "success") {
            notificationIcon.className =
              "fa fa-check-circle text-success text-xl";
            notification.classList.remove("bg-danger/10", "bg-warning/10");
            notification.classList.add("bg-success/10");
          } else if (type === "error") {
            notificationIcon.className =
              "fa fa-exclamation-circle text-danger text-xl";
            notification.classList.remove("bg-success/10", "bg-warning/10");
            notification.classList.add("bg-danger/10");
          } else if (type === "warning") {
            notificationIcon.className =
              "fa fa-exclamation-triangle text-warning text-xl";
            notification.classList.remove("bg-success/10", "bg-danger/10");
            notification.classList.add("bg-warning/10");
          }

          // 显示通知
          notification.classList.remove("translate-y-20", "opacity-0");
          notification.classList.add("translate-y-0", "opacity-100");

          // 3秒后自动关闭
          const timer = setTimeout(() => {
            this.closeNotification();
          }, 3000);

          // 手动关闭
          closeBtn.addEventListener("click", () => {
            clearTimeout(timer);
            this.closeNotification();
          });
        },

        // 关闭通知
        closeNotification() {
          const notification = document.getElementById("notification");
          notification.classList.remove("translate-y-0", "opacity-100");
          notification.classList.add("translate-y-20", "opacity-0");
        },

        // 切换批量操作模式
        toggleBatchMode(enable) {
          this.isBatchMode = enable;
          const batchOperations = document.getElementById("batch-operations");
          const bookmarkItems = document.querySelectorAll(".bookmark-item");
          const selectAllBtn = document.getElementById("select-all");
          const deselectAllBtn = document.getElementById("deselect-all");
          const batchDeleteBtn = document.getElementById("batch-delete");
          const exitBatchBtn = document.getElementById("exit-batch");
          const bookmarkBatchActions = document.getElementById(
            "bookmark-batch-actions"
          );

          if (enable) {
            // 进入批量模式
            batchOperations.classList.remove("hidden");
            bookmarkItems.forEach((item) => {
              item.classList.add("cursor-default");
              item.querySelector(".bookmark-select").classList.remove("hidden");

              // 添加点击选择事件
              item.addEventListener("click", this.handleBookmarkSelect);
            });
            bookmarkBatchActions.classList.add("hidden");
          } else {
            // 退出批量模式
            batchOperations.classList.add("hidden");
            bookmarkItems.forEach((item) => {
              item.classList.remove("cursor-default");
              item.querySelector(".bookmark-select").classList.add("hidden");
              item
                .querySelector(".bookmark-select")
                .classList.remove("bg-primary/10", "border-primary");
              item.querySelector(".bookmark-select i").classList.add("hidden");

              // 移除点击选择事件
              item.removeEventListener("click", this.handleBookmarkSelect);
            });
            bookmarkBatchActions.classList.remove("hidden");
          }
        },

        // 处理收藏项选择
        handleBookmarkSelect(e) {
          e.stopPropagation();
          const selectEl = this.querySelector(".bookmark-select");
          const isSelected = selectEl.classList.contains("bg-primary/10");

          if (isSelected) {
            // 取消选择
            selectEl.classList.remove("bg-primary/10", "border-primary");
            selectEl.querySelector("i").classList.add("hidden");
          } else {
            // 选中
            selectEl.classList.add("bg-primary/10", "border-primary");
            selectEl.querySelector("i").classList.remove("hidden");
          }
        },

        // 获取选中的收藏项ID
        getSelectedBookmarkIds() {
          const selectedIds = [];
          document.querySelectorAll(".bookmark-item").forEach((item) => {
            const selectEl = item.querySelector(".bookmark-select");
            if (selectEl.classList.contains("bg-primary/10")) {
              selectedIds.push(item.getAttribute("data-id"));
            }
          });
          return selectedIds;
        },

        // 全选收藏项
        selectAllBookmarks() {
          document.querySelectorAll(".bookmark-item").forEach((item) => {
            const selectEl = item.querySelector(".bookmark-select");
            selectEl.classList.add("bg-primary/10", "border-primary");
            selectEl.querySelector("i").classList.remove("hidden");
          });
        },

        // 取消全选收藏项
        deselectAllBookmarks() {
          document.querySelectorAll(".bookmark-item").forEach((item) => {
            const selectEl = item.querySelector(".bookmark-select");
            selectEl.classList.remove("bg-primary/10", "border-primary");
            selectEl.querySelector("i").classList.add("hidden");
          });
        },

        // 绑定事件
        bindEvents() {
          // 搜索表单提交
          document
            .getElementById("search-form")
            .addEventListener("submit", (e) => {
              e.preventDefault();
              const searchInput = document.getElementById("search-input");
              const query = searchInput.value.trim();

              if (query) {
                // 添加到搜索历史
                AppData.addSearchQuery(query);
                this.renderSearchHistory();

                // 根据选择的搜索引擎进行搜索
                const searchEngine =
                  document.getElementById("search-engine").value;
                let searchUrl = "";

                if (searchEngine === "baidu") {
                  searchUrl = `https://www.baidu.com/s?wd=${encodeURIComponent(
                    query
                  )}`;
                } else if (searchEngine === "bing") {
                  searchUrl = `https://www.bing.com/search?q=${encodeURIComponent(
                    query
                  )}`;
                }

                // 打开搜索页面
                window.open(searchUrl, "_blank");

                // 清空搜索框
                searchInput.value = "";
                document
                  .getElementById("search-history")
                  .classList.add("hidden");
              }
            });

          // 搜索框聚焦显示历史
          document
            .getElementById("search-input")
            .addEventListener("focus", () => {
              const history = AppData.getSearchHistory();
              if (history.length > 0) {
                document
                  .getElementById("search-history")
                  .classList.remove("hidden");
              }
            });

          // 点击页面其他地方隐藏搜索历史
          document.addEventListener("click", (e) => {
            const searchContainer =
              document.getElementById("search-form").parentElement;
            if (!searchContainer.contains(e.target)) {
              document.getElementById("search-history").classList.add("hidden");
            }
          });

          // 清空搜索历史
          document
            .getElementById("clear-history")
            .addEventListener("click", () => {
              this.openConfirmDialog(
                "确认清空",
                "你确定要清空所有搜索历史吗？",
                () => {
                  AppData.clearSearchHistory();
                  this.renderSearchHistory();
                  this.showNotification(
                    "清空成功",
                    "搜索历史已清空",
                    "success"
                  );
                }
              );
            });

          // 搜索引擎切换
          document
            .getElementById("search-engine")
            .addEventListener("change", (e) => {
              AppData.saveSettings({ searchEngine: e.target.value });
            });

          // 添加收藏按钮
          document
            .getElementById("add-bookmark-btn")
            .addEventListener("click", () => {
              this.openBookmarkModal();
            });

          // 关闭收藏模态框
          document
            .getElementById("close-bookmark-modal")
            .addEventListener("click", () => {
              this.closeBookmarkModal();
            });

          // 点击模态框背景关闭
          document
            .getElementById("modal-overlay")
            .addEventListener("click", () => {
              this.closeBookmarkModal();
            });

          // 收藏表单提交
          document
            .getElementById("bookmark-form")
            .addEventListener("submit", (e) => {
              e.preventDefault();
              const bookmarkId = document.getElementById("bookmark-id").value;
              const name = document
                .getElementById("bookmark-name")
                .value.trim();
              let url = document.getElementById("bookmark-url").value.trim();
              const icon = document
                .getElementById("bookmark-icon")
                .value.trim();

              // 确保URL以http://或https://开头
              if (!url.startsWith("http://") && !url.startsWith("https://")) {
                url = `https://${url}`;
              }

              if (bookmarkId) {
                // 更新收藏
                AppData.updateBookmark(bookmarkId, { name, url, icon });
                this.showNotification("更新成功", "收藏已更新", "success");
              } else {
                // 添加新收藏
                AppData.addBookmark({ name, url, icon });
                this.showNotification("添加成功", "已添加新收藏", "success");
              }

              // 关闭模态框并重新渲染
              this.closeBookmarkModal();
              this.renderBookmarks();
            });

          // 删除收藏按钮
          document
            .getElementById("delete-bookmark-btn")
            .addEventListener("click", () => {
              const bookmarkId = document.getElementById("bookmark-id").value;
              const bookmarkName = document
                .getElementById("bookmark-name")
                .value.trim();

              this.openConfirmDialog(
                "确认删除",
                `你确定要删除收藏"${bookmarkName}"吗？`,
                () => {
                  AppData.deleteBookmark(bookmarkId);
                  this.closeBookmarkModal();
                  this.renderBookmarks();
                  this.showNotification("删除成功", "收藏已删除", "success");
                }
              );
            });

          // 图标预览实时更新
          document
            .getElementById("bookmark-icon")
            .addEventListener("input", (e) => {
              const iconPreview = document.getElementById("icon-preview");
              const iconClass = e.target.value.trim();

              if (iconClass) {
                iconPreview.className = `fa ${iconClass} text-gray-500`;
              } else {
                iconPreview.className = "fa fa-link text-gray-500";
              }
            });

          // 打开背景设置
          document
            .getElementById("bg-settings-btn")
            .addEventListener("click", () => {
              this.openBgModal();
            });

          // 关闭背景设置
          document
            .getElementById("close-bg-modal")
            .addEventListener("click", () => {
              this.closeBgModal();
            });

          // 点击背景模态框背景关闭
          document
            .getElementById("bg-modal-overlay")
            .addEventListener("click", () => {
              this.closeBgModal();
            });

          // 选择默认背景
          document.querySelectorAll(".bg-option").forEach((option) => {
            option.addEventListener("click", () => {
              const bgUrl = option.getAttribute("data-bg");
              AppData.saveSettings({ background: bgUrl });
              this.renderBackground();
              this.closeBgModal();
              this.showNotification(
                "背景已更新",
                "已应用新的背景图片",
                "success"
              );
            });
          });

          // 上传背景图片
          document
            .getElementById("bg-upload")
            .addEventListener("change", (e) => {
              const file = e.target.files[0];
              if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                  AppData.saveSettings({ background: event.target.result });
                  this.renderBackground();
                  this.closeBgModal();
                  this.showNotification(
                    "背景已更新",
                    "已应用上传的背景图片",
                    "success"
                  );
                };
                reader.readAsDataURL(file);
              }
            });

          // 恢复默认背景
          document.getElementById("reset-bg").addEventListener("click", () => {
            AppData.saveSettings({
              background: "https://picsum.photos/id/1002/1920/1080",
            });
            this.renderBackground();
            this.closeBgModal();
            this.showNotification(
              "背景已重置",
              "已恢复默认背景图片",
              "success"
            );
          });

          // 主题切换
          document
            .getElementById("theme-toggle")
            .addEventListener("click", () => {
              const settings = AppData.getSettings();
              const newTheme = settings.theme === "dark" ? "light" : "dark";
              AppData.saveSettings({ theme: newTheme });
              this.renderTheme();
              this.showNotification(
                "主题已切换",
                `已切换到${newTheme === "dark" ? "深色" : "浅色"}模式`,
                "success"
              );
            });

          // 极简模式切换
          document
            .getElementById("minimal-mode-toggle")
            .addEventListener("click", () => {
              const settings = AppData.getSettings();
              const newMode = !settings.minimalMode;
              AppData.saveSettings({ minimalMode: newMode });
              this.renderMinimalMode();
              this.showNotification(
                "模式已切换",
                `已${newMode ? "开启" : "关闭"}极简模式`,
                "success"
              );
            });

          // 批量操作按钮
          document
            .getElementById("bookmark-batch-actions")
            .addEventListener("click", () => {
              this.toggleBatchMode(true);
            });

          // 退出批量操作
          document
            .getElementById("exit-batch")
            .addEventListener("click", () => {
              this.toggleBatchMode(false);
            });

          // 全选
          document
            .getElementById("select-all")
            .addEventListener("click", () => {
              this.selectAllBookmarks();
            });

          // 取消全选
          document
            .getElementById("deselect-all")
            .addEventListener("click", () => {
              this.deselectAllBookmarks();
            });

          // 批量删除
          document
            .getElementById("batch-delete")
            .addEventListener("click", () => {
              const selectedIds = this.getSelectedBookmarkIds();

              if (selectedIds.length === 0) {
                this.showNotification(
                  "操作失败",
                  "请先选择要删除的收藏",
                  "warning"
                );
                return;
              }

              this.openConfirmDialog(
                "确认删除",
                `你确定要删除选中的${selectedIds.length}个收藏吗？`,
                () => {
                  AppData.batchDeleteBookmarks(selectedIds);
                  this.renderBookmarks();
                  this.toggleBatchMode(false);
                  this.showNotification(
                    "删除成功",
                    `已删除${selectedIds.length}个收藏`,
                    "success"
                  );
                }
              );
            });
        },
      };

      // 初始化应用
      document.addEventListener("DOMContentLoaded", () => {
        AppData.init();
        ViewController.init();
      });
    </script>
    <!-- 引入外部JS -->
    <script src="src/js/script.js"></script>
  </body>
</html>
